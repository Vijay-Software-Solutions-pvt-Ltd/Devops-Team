import{a as I,u as E,r as u,j as e,I as F,F as z,k as v,J as O,O as D,K as G,M as Q,E as J}from"./index-DyprfCce.js";import{a as f}from"./api-Bbd7J0M8.js";function H(){const{id:g}=I(),m=E(),[C,h]=u.useState(!0),[i,d]=u.useState({title:"",description:"",duration:60,start_date:"",end_date:"",org_id:""}),[p,c]=u.useState([]),[_,w]=u.useState([]);u.useEffect(()=>{y()},[g,m]);async function y(){var t;h(!0);try{const[a,o]=await Promise.all([f.get("/admin/orgs"),f.get(`/admin/exams/${g}`)]);(t=a.data)!=null&&t.orgs&&w(a.data.orgs);const s=o.data.exam,l=o.data.questions,x=r=>{if(!r)return"";const j=new Date(r);return new Date(j.getTime()-j.getTimezoneOffset()*6e4).toISOString().slice(0,16)};d({title:s.title,description:s.description||"",duration:s.duration_minutes,start_date:x(s.start_date),end_date:x(s.end_date),org_id:""}),c(l.map(r=>({...r,content:typeof r.content=="string"?JSON.parse(r.content):r.content,choices:typeof r.choices=="string"?JSON.parse(r.choices):r.choices||[],correct_answer:typeof r.correct_answer=="string"?JSON.parse(r.correct_answer):r.correct_answer||{correct:0}}))),h(!1)}catch(a){console.error(a),alert("Failed to load exam data"),m("/admin/exams")}}function b(t){c(a=>[...a,{type:t,difficulty:t==="coding"?"hard":"normal",content:{prompt:""},choices:t==="mcq"?["","","",""]:null,correct_answer:t==="mcq"?{correct:0}:null,points:t==="coding"?10:2}])}function S(t){c(a=>a.filter((o,s)=>s!==t))}function B(t,a,o){const s=[...p];s[t].content.prompt=o,c(s)}function R(t,a,o){const s=[...p];s[t].choices[a]=o,c(s)}function T(t){const a=t.target.files[0];if(!a)return;const o=new FileReader;o.onload=s=>{try{const l=JSON.parse(s.target.result);if(Array.isArray(l)){const x=l.map(r=>({id:void 0,type:r.type||"mcq",difficulty:r.difficulty||"normal",content:r.content||{prompt:"Imported Question"},choices:r.choices||[],correct_answer:r.correct_answer||{correct:0},points:r.points||1}));c(r=>[...r,...x]),alert(`Imported ${x.length} questions!`)}else alert("JSON file must be an array of questions.")}catch{alert("Invalid JSON file")}},o.readAsText(a)}async function k(){if(!i.title)return alert("Title required");const t=a=>a?new Date(a).toISOString():null;try{await f.put(`/admin/exams/${g}`,{...i,start_date:t(i.start_date),end_date:t(i.end_date),duration_minutes:i.duration,questions:p}),alert("Exam updated successfully!"),await y()}catch(a){console.error(a),alert("Failed to update exam")}}return C?e.jsx("div",{style:{padding:40},children:"Loading..."}):e.jsxs("div",{style:n.container,children:[e.jsxs("h1",{style:n.title,children:["Edit Exam: ",i.title]}),e.jsxs("div",{style:n.grid,children:[e.jsxs("div",{style:n.card,children:[e.jsxs("h3",{style:n.cardTitle,children:[" ",e.jsx(F,{style:{marginRight:8}})," Exam Details"]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Exam Title"}),e.jsx("input",{style:n.input,value:i.title,onChange:t=>d({...i,title:t.target.value})})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Description"}),e.jsx("textarea",{style:{...n.input,height:"80px",resize:"vertical"},value:i.description,onChange:t=>d({...i,description:t.target.value})})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Organization (Re-assign)"}),e.jsxs("select",{style:n.select,value:i.org_id,onChange:t=>d({...i,org_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Keep current (or select to change)"}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{style:n.row,children:e.jsxs("div",{style:n.col,children:[e.jsxs("label",{style:n.label,children:[e.jsx(z,{})," Duration (min)"]}),e.jsx("input",{type:"number",style:n.input,value:i.duration,onChange:t=>d({...i,duration:t.target.value})})]})}),e.jsxs("div",{style:n.formGroup,children:[e.jsxs("label",{style:n.label,children:[e.jsx(v,{})," Start Date"]}),e.jsx("input",{type:"datetime-local",style:n.input,value:i.start_date,onChange:t=>d({...i,start_date:t.target.value})})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsxs("label",{style:n.label,children:[e.jsx(v,{})," End Date"]}),e.jsx("input",{type:"datetime-local",style:n.input,value:i.end_date,onChange:t=>d({...i,end_date:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:n.questionsHeader,children:[e.jsxs("h3",{style:{...n.cardTitle,marginBottom:0},children:["Questions (",p.length,")"]}),e.jsxs("div",{style:n.btnGroup,children:[e.jsxs("label",{style:n.uploadBtn,children:[e.jsx(O,{style:{marginRight:6}})," Import JSON",e.jsx("input",{type:"file",accept:".json",onChange:T,style:{display:"none"}})]}),e.jsx("button",{style:n.addBtn,onClick:()=>b("mcq"),children:"+ MCQ"}),e.jsx("button",{style:n.addBtn,onClick:()=>b("coding"),children:"+ Coding"}),e.jsxs("button",{style:n.publishBtn,onClick:k,children:[e.jsx(D,{style:{marginRight:8}})," Save Changes"]})]})]}),p.map((t,a)=>e.jsxs("div",{style:n.questionCard,children:[e.jsxs("div",{style:n.qHeader,children:[e.jsxs("span",{style:n.qTypeBadge,children:[t.type==="mcq"?e.jsx(G,{}):e.jsx(Q,{})," ",t.type.toUpperCase()]}),e.jsx("button",{style:n.deleteBtn,onClick:()=>S(a),children:e.jsx(J,{})})]}),e.jsxs("div",{style:n.formGroup,children:[e.jsx("label",{style:n.label,children:"Prompt / Question"}),e.jsx("textarea",{style:{...n.input,height:"60px"},value:t.content.prompt,onChange:o=>B(a,"prompt",o.target.value)})]}),t.type==="mcq"&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("label",{style:n.label,children:"Choices"}),t.choices.map((o,s)=>e.jsxs("div",{style:n.choiceRow,children:[e.jsx("input",{type:"radio",name:`correct-${a}`,checked:t.correct_answer.correct===s,onChange:()=>{const l=[...p];l[a].correct_answer.correct=s,c(l)}}),e.jsx("input",{style:n.choiceInput,value:o,onChange:l=>R(a,s,l.target.value)})]},s))]})]},a))]})]})]})}const n={container:{padding:"32px",maxWidth:"1200px",margin:"0 auto",fontFamily:"'Inter', sans-serif"},title:{fontSize:"28px",fontWeight:"700",color:"#1e293b",marginBottom:"32px"},grid:{display:"grid",gridTemplateColumns:"350px 1fr",gap:"32px",alignItems:"start"},card:{background:"#fff",borderRadius:"12px",padding:"24px",boxShadow:"0 4px 6px rgba(0,0,0,0.02)",border:"1px solid #e2e8f0"},cardTitle:{fontSize:"18px",fontWeight:"600",marginBottom:"20px",color:"#334155",display:"flex",alignItems:"center"},formGroup:{marginBottom:"16px"},label:{display:"block",fontSize:"13px",fontWeight:"500",color:"#64748b",marginBottom:"6px"},input:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #cbd5e1",fontSize:"14px",outline:"none",boxSizing:"border-box"},select:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #cbd5e1",background:"#fff"},row:{display:"flex",gap:"12px"},col:{flex:1},questionsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},btnGroup:{display:"flex",gap:"8px"},addBtn:{background:"#fff",border:"1px solid #cbd5e1",padding:"8px 16px",borderRadius:"8px",fontSize:"13px",fontWeight:"600",color:"#475569",cursor:"pointer"},uploadBtn:{background:"#f0fdf4",border:"1px solid #bbf7d0",padding:"8px 16px",borderRadius:"8px",fontSize:"13px",fontWeight:"600",color:"#166534",cursor:"pointer",display:"flex",alignItems:"center"},questionCard:{background:"#fff",borderRadius:"12px",padding:"20px",marginBottom:"16px",border:"1px solid #e2e8f0",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},qHeader:{display:"flex",justifyContent:"space-between",marginBottom:"16px"},qTypeBadge:{background:"#f1f5f9",padding:"4px 10px",borderRadius:"6px",fontSize:"12px",fontWeight:"600",color:"#475569"},deleteBtn:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer"},choiceRow:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},choiceInput:{flex:1,padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px"},publishBtn:{width:"100%",padding:"14px",background:"#2563eb",color:"#fff",border:"none",borderRadius:"10px",fontWeight:"600",fontSize:"16px",cursor:"pointer",marginTop:"16px",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 12px rgba(37,99,235,0.2)"}};export{H as default};
//# sourceMappingURL=AdminEditExam-deqGONaP.js.map
