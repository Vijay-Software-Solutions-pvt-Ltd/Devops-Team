import{r as l,j as e,P as v,z as w,L as S,Q as D}from"./index-DyprfCce.js";import{a as x}from"./api-Bbd7J0M8.js";function L(){const[n,m]=l.useState([]),[h,d]=l.useState(!0),[a,p]=l.useState({org_id:"",user_id:"",exam_id:""}),[u,g]=l.useState([]);l.useEffect(()=>{b(),c()},[]);const b=async()=>{try{const t=await x.get("/admin/orgs");g(t.data.orgs||t.data)}catch(t){console.error("Failed to fetch orgs",t)}},c=async()=>{d(!0);try{const t=new URLSearchParams;a.org_id&&t.append("org_id",a.org_id),a.user_id&&t.append("user_id",a.user_id),a.exam_id&&t.append("exam_id",a.exam_id);const i=await x.get(`/admin/results?${t.toString()}`);m(i.data)}catch(t){console.error("Failed to fetch results",t)}finally{d(!1)}},r=t=>{p({...a,[t.target.name]:t.target.value})},f=t=>{t.preventDefault(),c()},j=()=>{const t=["Attempt ID","User Name","User Email","Organization","Exam Title","Score","Status","Started At","Finished At"],i=n.map(s=>[s.id,s.user_name,s.user_email,s.org_name||s.org_id,s.exam_title,s.total_score,s.status,new Date(s.started_at_server).toLocaleString(),s.finished_at?new Date(s.finished_at).toLocaleString():"-"]),N=[t.join(","),...i.map(s=>s.map(_=>`"${String(_).replace(/"/g,'""')}"`).join(","))].join(`
`),y=new Blob([N],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(y),o.download=`exam_results_${new Date().toISOString().split("T")[0]}.csv`,o.click()};return e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Exam Results"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Real-time monitoring of student performance"})]}),e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm",children:[e.jsx(v,{}),e.jsx("span",{children:"Export CSV"})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8",children:e.jsxs("form",{onSubmit:f,className:"grid grid-cols-1 md:grid-cols-4 gap-6 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Organization"}),e.jsx("div",{className:"relative",children:e.jsxs("select",{name:"org_id",value:a.org_id,onChange:r,className:"w-full pl-3 pr-10 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm",children:[e.jsx("option",{value:"",children:"All Organizations"}),u.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.id,")"]},t.id))]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"User ID / Email"}),e.jsx("input",{type:"text",name:"user_id",value:a.user_id,onChange:r,placeholder:"Search by User ID...",className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Exam ID"}),e.jsx("input",{type:"text",name:"exam_id",value:a.exam_id,onChange:r,placeholder:"Filter by Exam ID...",className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm"})]}),e.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-medium transition-colors shadow-md flex justify-center items-center space-x-2",children:[e.jsx(w,{}),e.jsx("span",{children:"Apply Filters"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:h?e.jsx("div",{className:"p-12 text-center text-slate-500",children:"Loading results..."}):n.length===0?e.jsx("div",{className:"p-12 text-center text-slate-500",children:"No results found matching your criteria."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wider text-slate-500 font-semibold",children:[e.jsx("th",{className:"px-6 py-4",children:"Student"}),e.jsx("th",{className:"px-6 py-4",children:"Organization"}),e.jsx("th",{className:"px-6 py-4",children:"Exam"}),e.jsx("th",{className:"px-6 py-4",children:"Score"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50/80 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-slate-900",children:t.user_name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.user_email})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:t.org_name||e.jsx("span",{className:"font-mono text-xs",children:t.org_id})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 font-medium",children:t.exam_title}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${t.total_score>=80?"bg-green-100 text-green-800":t.total_score>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[t.total_score||0," pts"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${t.status==="submitted"?"bg-blue-100 text-blue-800":t.status==="in_progress"?"bg-purple-100 text-purple-800":"bg-slate-100 text-slate-800"}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:new Date(t.started_at_server).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(S,{to:`/admin/results/${t.id}`,className:"inline-flex items-center justify-center p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition-colors",title:"View Details",children:e.jsx(D,{className:"w-5 h-5"})})})]},t.id))})]})})})]})}export{L as default};
//# sourceMappingURL=AdminResults-BHFZdcjP.js.map
