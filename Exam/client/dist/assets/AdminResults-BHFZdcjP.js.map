{"version":3,"file":"AdminResults-BHFZdcjP.js","sources":["../../src/pages/admin/AdminResults.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport api from '../../services/api';\nimport { FiDownload, FiSearch, FiEye, FiFilter } from 'react-icons/fi';\n\nexport default function AdminResults() {\n    const [results, setResults] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [filters, setFilters] = useState({\n        org_id: '',\n        user_id: '',\n        exam_id: ''\n    });\n    const [orgs, setOrgs] = useState([]);\n\n    useEffect(() => {\n        fetchOrgs();\n        fetchResults();\n    }, []);\n\n    const fetchOrgs = async () => {\n        try {\n            const res = await api.get('/admin/orgs'); // Assuming this endpoint exists based on routes\n            setOrgs(res.data.orgs || res.data);\n        } catch (err) {\n            console.error('Failed to fetch orgs', err);\n        }\n    };\n\n    const fetchResults = async () => {\n        setLoading(true);\n        try {\n            // Build query string\n            const params = new URLSearchParams();\n            if (filters.org_id) params.append('org_id', filters.org_id);\n            if (filters.user_id) params.append('user_id', filters.user_id);\n            if (filters.exam_id) params.append('exam_id', filters.exam_id);\n\n            const res = await api.get(`/admin/results?${params.toString()}`);\n            setResults(res.data);\n        } catch (err) {\n            console.error('Failed to fetch results', err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleFilterChange = (e) => {\n        setFilters({ ...filters, [e.target.name]: e.target.value });\n    };\n\n    const handleSearch = (e) => {\n        e.preventDefault();\n        fetchResults();\n    };\n\n    // Fallback CSV export if XLSX is not installed\n    const handleExportCSV = () => {\n        const header = ['Attempt ID', 'User Name', 'User Email', 'Organization', 'Exam Title', 'Score', 'Status', 'Started At', 'Finished At'];\n        const rows = results.map(r => [\n            r.id,\n            r.user_name,\n            r.user_email,\n            r.org_name || r.org_id,\n            r.exam_title,\n            r.total_score,\n            r.status,\n            new Date(r.started_at_server).toLocaleString(),\n            r.finished_at ? new Date(r.finished_at).toLocaleString() : '-'\n        ]);\n\n        const csvContent = [\n            header.join(','),\n            ...rows.map(row => row.map(cell => `\"${String(cell).replace(/\"/g, '\"\"')}\"`).join(','))\n        ].join('\\n');\n\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement('a');\n        link.href = URL.createObjectURL(blob);\n        link.download = `exam_results_${new Date().toISOString().split('T')[0]}.csv`;\n        link.click();\n    };\n\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            <div className=\"flex justify-between items-center mb-8\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-slate-800\">Exam Results</h1>\n                    <p className=\"text-slate-500 mt-1\">Real-time monitoring of student performance</p>\n                </div>\n                <button\n                    onClick={handleExportCSV}\n                    className=\"flex items-center space-x-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm\"\n                >\n                    <FiDownload />\n                    <span>Export CSV</span>\n                </button>\n            </div>\n\n            {/* Filters */}\n            <div className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8\">\n                <form onSubmit={handleSearch} className=\"grid grid-cols-1 md:grid-cols-4 gap-6 items-end\">\n                    <div>\n                        <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Organization</label>\n                        <div className=\"relative\">\n                            <select\n                                name=\"org_id\"\n                                value={filters.org_id}\n                                onChange={handleFilterChange}\n                                className=\"w-full pl-3 pr-10 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm\"\n                            >\n                                <option value=\"\">All Organizations</option>\n                                {orgs.map(org => (\n                                    <option key={org.id} value={org.id}>{org.name} ({org.id})</option>\n                                ))}\n                            </select>\n                        </div>\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-semibold text-slate-700 mb-2\">User ID / Email</label>\n                        <input\n                            type=\"text\"\n                            name=\"user_id\"\n                            value={filters.user_id}\n                            onChange={handleFilterChange}\n                            placeholder=\"Search by User ID...\"\n                            className=\"w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm\"\n                        />\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Exam ID</label>\n                        <input\n                            type=\"text\"\n                            name=\"exam_id\"\n                            value={filters.exam_id}\n                            onChange={handleFilterChange}\n                            placeholder=\"Filter by Exam ID...\"\n                            className=\"w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm\"\n                        />\n                    </div>\n\n                    <button\n                        type=\"submit\"\n                        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-medium transition-colors shadow-md flex justify-center items-center space-x-2\"\n                    >\n                        <FiSearch />\n                        <span>Apply Filters</span>\n                    </button>\n                </form>\n            </div>\n\n            {/* Results Table */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n                {loading ? (\n                    <div className=\"p-12 text-center text-slate-500\">Loading results...</div>\n                ) : results.length === 0 ? (\n                    <div className=\"p-12 text-center text-slate-500\">No results found matching your criteria.</div>\n                ) : (\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-left\">\n                            <thead>\n                                <tr className=\"bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wider text-slate-500 font-semibold\">\n                                    <th className=\"px-6 py-4\">Student</th>\n                                    <th className=\"px-6 py-4\">Organization</th>\n                                    <th className=\"px-6 py-4\">Exam</th>\n                                    <th className=\"px-6 py-4\">Score</th>\n                                    <th className=\"px-6 py-4\">Status</th>\n                                    <th className=\"px-6 py-4\">Date</th>\n                                    <th className=\"px-6 py-4 text-right\">Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-slate-100\">\n                                {results.map((result) => (\n                                    <tr key={result.id} className=\"hover:bg-slate-50/80 transition-colors\">\n                                        <td className=\"px-6 py-4\">\n                                            <div className=\"font-medium text-slate-900\">{result.user_name}</div>\n                                            <div className=\"text-xs text-slate-500\">{result.user_email}</div>\n                                        </td>\n                                        <td className=\"px-6 py-4 text-sm text-slate-600\">\n                                            {result.org_name || <span className=\"font-mono text-xs\">{result.org_id}</span>}\n                                        </td>\n                                        <td className=\"px-6 py-4 text-sm text-slate-600 font-medium\">\n                                            {result.exam_title}\n                                        </td>\n                                        <td className=\"px-6 py-4\">\n                                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${result.total_score >= 80 ? 'bg-green-100 text-green-800' :\n                                                result.total_score >= 50 ? 'bg-yellow-100 text-yellow-800' :\n                                                    'bg-red-100 text-red-800'\n                                                }`}>\n                                                {result.total_score || 0} pts\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4\">\n                                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${result.status === 'submitted' ? 'bg-blue-100 text-blue-800' :\n                                                result.status === 'in_progress' ? 'bg-purple-100 text-purple-800' :\n                                                    'bg-slate-100 text-slate-800'\n                                                }`}>\n                                                {result.status.replace('_', ' ')}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 text-sm text-slate-500\">\n                                            {new Date(result.started_at_server).toLocaleDateString()}\n                                        </td>\n                                        <td className=\"px-6 py-4 text-right\">\n                                            <Link\n                                                to={`/admin/results/${result.id}`}\n                                                className=\"inline-flex items-center justify-center p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition-colors\"\n                                                title=\"View Details\"\n                                            >\n                                                <FiEye className=\"w-5 h-5\" />\n                                            </Link>\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":["AdminResults","results","setResults","useState","loading","setLoading","filters","setFilters","orgs","setOrgs","useEffect","fetchOrgs","fetchResults","res","api","err","params","handleFilterChange","e","handleSearch","handleExportCSV","header","rows","r","csvContent","row","cell","blob","link","jsxs","jsx","FiDownload","org","FiSearch","result","Link","FiEye"],"mappings":"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"}