import{U as $,u as O,r as i,j as e}from"./index-DyprfCce.js";const v="https://razorpay-backend-931100197216.asia-south1.run.app";function B(){const C=$(),m=O(),b=new URLSearchParams(C.search),r=b.get("plan")||"institutional",p=b.get("amount");let o=p?parseInt(p,10):null;o||(r==="institutional"?o=42e4:r==="flexi"?o=18e3:o=1e4);const[s,k]=i.useState({orgName:"",firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",street:"",city:"",state:"",zipCode:"",country:""}),[u,S]=i.useState(""),[x,d]=i.useState(!1),[h,g]=i.useState(0),[P,f]=i.useState(!1),[j,N]=i.useState(""),t=a=>k({...s,[a.target.name]:a.target.value}),z=async()=>{try{const n=await(await fetch(`${v}/api/coupons/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({couponCode:u,trainingId:r==="institutional"?1:2})})).json();if(n.valid){const l=Math.round(o*(n.discount_percent/100));g(l),f(!0),N("")}else throw new Error(n.message||"Invalid coupon")}catch(a){g(0),f(!1),N(a.message||"Invalid or expired coupon")}},L=async a=>{if(a.preventDefault(),s.password!==s.confirmPassword){alert("Passwords do not match");return}d(!0);try{const l=await(await fetch(`${v}/api/subscription/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:r,baseAmount:o,couponCode:u,...s})})).json();if(!l.razorpay_key)throw new Error(l.error||"Payment initiation failed");const q={key:l.razorpay_key,amount:l.amount,currency:"INR",order_id:l.order_id,name:"ExamPortal by Vijay Software",description:`Subscription: ${r.toUpperCase()}`,handler:async function(w){try{const c=await fetch("http://localhost:8082/auth/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orgName:s.orgName,firstName:s.firstName,lastName:s.lastName,email:s.email,password:s.password,phone:s.phone,address:`${s.street}, ${s.city}, ${s.state} ${s.zipCode}, ${s.country}`,plan:r})}),E=await c.json();if(!c.ok)throw new Error(E.error||"Failed to register subscription credentials.");alert("Payment successful! Subscription activated. You can now log in."),m("/login")}catch(c){alert("Payment was successful but we couldn't create your account: "+c.message)}},modal:{ondismiss:function(){d(!1)}},prefill:{name:`${s.firstName} ${s.lastName}`,email:s.email,contact:s.phone},theme:{color:"#4f46e5"}},y=new window.Razorpay(q);y.on("payment.failed",function(w){alert("Payment failed: "+w.error.description),d(!1)}),y.open()}catch(n){alert(n.message),d(!1)}},A=o-h;return e.jsx("div",{className:"min-h-screen bg-slate-50 pt-24 pb-12 font-sans text-slate-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsxs("button",{onClick:()=>m("/"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center transition",children:[e.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back"]}),e.jsx("h1",{className:"text-3xl font-extrabold text-slate-900 tracking-tight",children:"Complete your Subscription"})]}),e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"lg:col-span-7 xl:col-span-8 space-y-6 bg-white p-8 sm:p-10 rounded-2xl border border-slate-200 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-slate-800 border-b border-slate-100 pb-4",children:"Organization & Billing"}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Organization / Institution Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"orgName",value:s.orgName,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"University / Company Name"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"First Name"}),e.jsx("input",{onChange:t,name:"firstName",value:s.firstName,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Last Name"}),e.jsx("input",{onChange:t,name:"lastName",value:s.lastName,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"email",value:s.email,type:"email",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"phone",value:s.phone,type:"tel",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5 mb-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"password",value:s.password,type:"password",minLength:"6",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"To access your dashboard"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Confirm Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"confirmPassword",value:s.confirmPassword,type:"password",minLength:"6",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"Re-enter password"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{onChange:t,name:"street",value:s.street,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all mb-3",required:!0,placeholder:"Street Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5 mb-3",children:[e.jsx("input",{onChange:t,name:"city",value:s.city,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"City"}),e.jsx("input",{onChange:t,name:"state",value:s.state,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"State / Province"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsx("input",{onChange:t,name:"zipCode",value:s.zipCode,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"Zip Code"}),e.jsx("input",{onChange:t,name:"country",value:s.country,type:"text",className:"w-full bg-slate-50 border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,placeholder:"Country"})]})]})]}),e.jsx("div",{className:"lg:col-span-5 xl:col-span-4 h-full relative",children:e.jsxs("div",{className:"sticky top-24 bg-white p-8 rounded-2xl border border-slate-200 shadow-xl flex flex-col justify-between overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1.5 bg-gradient-to-r from-blue-500 to-indigo-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-slate-800 border-b border-slate-100 pb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 border border-slate-100 p-4 rounded-xl",children:[e.jsxs("span",{className:"font-semibold text-slate-600",children:["Plan: ",e.jsx("span",{className:"text-slate-900 capitalize ml-1",children:r})]}),e.jsxs("span",{className:"font-bold text-slate-900",children:["₹",o.toLocaleString()]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Coupon Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:a=>S(a.target.value.toUpperCase()),placeholder:"Enter code",className:"bg-white border border-slate-200 text-slate-900 rounded-lg py-2.5 px-4 flex-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none uppercase font-medium"}),e.jsx("button",{type:"button",onClick:z,className:"bg-slate-800 hover:bg-slate-900 text-white px-5 py-2.5 rounded-lg font-semibold transition-colors shadow-sm",children:"Apply"})]})]}),j&&e.jsx("p",{className:"text-red-500 text-sm font-medium",children:j}),P&&e.jsxs("div",{className:"flex justify-between items-center text-emerald-600 font-semibold bg-emerald-50 p-3 rounded-lg border border-emerald-100 mt-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Discount Applied"]}),e.jsxs("span",{children:["- ₹",h.toLocaleString()]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 bg-blue-50/50 p-5 rounded-xl border border-blue-100",children:[e.jsx("span",{className:"text-lg font-bold text-slate-800",children:"Total Due"}),e.jsxs("span",{className:"text-3xl font-extrabold text-blue-600 flex items-baseline tracking-tight",children:[e.jsx("span",{className:"text-blue-500 text-xl mr-1 font-bold",children:"₹"}),A.toLocaleString()]})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full py-4 rounded-xl bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-bold text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all flex justify-center items-center",children:x?e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):"Proceed to Pay Secured"}),e.jsxs("div",{className:"text-center mt-5 flex items-center justify-center text-slate-500 text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5 text-emerald-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Payments are 100% secured by Razorpay"]})]})]})})]})]})})}export{B as default};
//# sourceMappingURL=Checkout-D3D64LFa.js.map
